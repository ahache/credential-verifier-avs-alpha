#!/bin/bash

# Exit immediately if a command exits with a non-zero status
set -e

# Get the directory of the current script
SCRIPT_DIR=$(dirname "$(realpath "$0")")
PROJECT_ROOT=$(realpath "$SCRIPT_DIR/..")

# Path to the ABI file generated by forge build
ABI_SOURCE="$PROJECT_ROOT/out/CredentialVerifierServiceManager.sol/CredentialVerifierServiceManager.json"

# Path to the TypeScript ABI file
ABI_DEST="$PROJECT_ROOT/operator/abis/credentialVerifierABI.ts"

# Extract the ABI from the JSON file and format it for TypeScript
echo "Updating ABI in $ABI_DEST..."
echo "export const credentialVerifierABI = " > "$ABI_DEST"
jq '.abi' "$ABI_SOURCE" >> "$ABI_DEST"

echo "ABI updated successfully."